package fr.unice.polytech.si3.qgl.iaac.ground;

import fr.unice.polytech.si3.qgl.iaac.carte.Carte;
import fr.unice.polytech.si3.qgl.iaac.contracts.Contract;
import fr.unice.polytech.si3.qgl.iaac.contracts.Contracts;
import fr.unice.polytech.si3.qgl.iaac.ReadJSON;
import fr.unice.polytech.si3.qgl.iaac.resources.EnumPrimaryResources;
import fr.unice.polytech.si3.qgl.iaac.resources.EnumResources;

import java.util.List;

/**
 * Created by lehmann on 12/02/17.
 */
public class Exploit implements State {

    private List<EnumResources> resources;
    private Contracts contracts;

    public Exploit(List<EnumResources> resources){
        this.resources = resources;
    }

    @Override
    public String execute(Men men, Contracts contracts, Carte carte) {
        this.contracts = contracts;
        return men.exploit(resources.get(0));
    }

    @Override
    public State wait(ReadJSON json) {
        Contract contract = contracts.getPrimaryContract((EnumPrimaryResources)resources.get(0));
        resources.remove(0);
        contract.sub(json.getCollect());
        contracts.verifyContractCompleted(contract);
        if(resources.size()!=0){
            return new Exploit(resources);
        }

        else if(contracts.isPrimaryCompleted()){
            return new DefineWaySecond();
        }
        else
            return new DefineWay();
    }

}
